 
 /********* Begin Procedure Script ************/ 
 BEGIN 
 DECLARE VARCOUNT INTEGER;
 
 DECLARE DATE_A DATE := :C_INPUT_TO ;

 IF :C_INPUT_TO = CURRENT_DATE
 THEN 
 SELECT ADD_DAYS(CURRENT_DATE,-1) INTO DATE_A FROM DUMMY;
 END IF;

 SELECT COUNT(*) INTO VARCOUNT 
 FROM "RFC_USER"."DASHBOARD_MV_D" 
 WHERE FECHA =  :DATE_A ;
 
 IF VARCOUNT > 0
 
 THEN 
 var_out = 
SELECT HUB, COALESCE(SUBREGION,'ND') AS SUBREGION , REGION AS REGION_1, 
	CIUDAD AS PLAZA, EMPRESA,
	MAX(:DATE_A) 	AS FECHA_REPORTE,
	SUM(VENTA_TOTAL) 	AS VENTAS_TOTALES,
	SUM(INSTALACIONES) 	AS INSTALACIONES,
	SUM(PERDIDAS) 		AS NO_PERDIDAS,
	SUM(CASE WHEN FECHA = :DATE_A 	THEN NO_RGU ELSE 0 END)	AS NO_RGU,
	SUM(SERVICIOS_VENTAS) 	AS SERVICIOS_VENTAS,
	SUM(SERVICIOS_INSTALACIONS) 	AS SERVICIOS_INSTALACIONS,
	SUM(CASE WHEN FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_NO_RGU,
	SUM(VENTA_TOTAL_PM)	AS VENTAS_TOTALES_PM,
	SUM(INSTALACIONES_PM) 	AS INSTALACIONES_PM,
	SUM(PERDIDAS_PM)	AS NO_PERDIDAS_PM,
	SUM(CASE WHEN FECHA = CASE WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END 
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_PM,
	SUM(VENTA_TOTAL_PY)	AS VENTAS_TOTALES_PY,
	SUM(INSTALACIONES_PY)	AS INSTALACIONES_PY,
	SUM(PERDIDAS_PY)	AS NO_PERDIDAS_PY,
	SUM(CASE WHEN FECHA = :DATE_A THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_PY,
	NULL 				AS VENTAS_IZZY,
	NULL				AS INSTALACIONES_IZZY,
	NULL 				AS PERDIDAS_IZZY,
	NULL 				AS RGU_IZZY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL ELSE 0 END) 	
		AS VENTAS_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL ELSE 0 END) 	
		AS VENTAS_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL ELSE 0 END)	
		AS VENTAS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL_PM ELSE 0 END) 
		AS VENTAS_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL_PM ELSE 0 END)	
		AS VENTAS_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL_PM ELSE 0 END)	
		AS VENTAS_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL_PY ELSE 0 END) 
		AS VENTAS_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL_PY ELSE 0 END)	
		AS VENTAS_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL_PY ELSE 0 END)	
		AS VENTAS_VIDEO_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES ELSE 0 END) 	
		AS INSTALACIONES_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES ELSE 0 END)	
		AS INSTALACIONES_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES_PM ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES_PM ELSE 0 END) 	
		AS INSTALACIONES_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES_PM ELSE 0 END)	
		AS INSTALACIONES_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES_PY ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES_PY ELSE 0 END) 	
		AS INSTALACIONES_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES_PY ELSE 0 END)	
		AS INSTALACIONES_VIDEO_PY,	
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS_PM ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS_PM ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS_PM ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS_PY ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS_PY ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS_PY ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO_PY,	
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	AND  FECHA = :DATE_A 
		THEN NO_RGU ELSE 0 END)	AS NO_RGU_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	AND  FECHA = :DATE_A
	 	THEN NO_RGU ELSE 0 END)	AS NO_RGU_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	AND  FECHA = :DATE_A
	 	THEN NO_RGU ELSE 0 END)	AS NO_RGU_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1))
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_INTERNET_PM,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = :DATE_A 
		THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = :DATE_A
	 	THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_INTERNET_PY,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = :DATE_A
	 	THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_VIDEO_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_TELEFONIA,	
	SUM(CASE WHEN CATEGORIA = 'INTERNET'
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_VIDEO,			
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_TELEFONIA,	
	SUM(CASE WHEN CATEGORIA = 'INTERNET'
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_VIDEO,
	NULL 	AS SERVICIOS_VENTAS_IZZY,
	NULL	AS SERVICIOS_INSTALACIONS_IZZY,
	NULL	AS NO_PERDIDAS_PM_IZZY,
	NULL	AS NO_RGU_PM_IZZY,
	SUM(ORD_VENTA_CANCELADA)		AS NO_CANCELACIONES,
	SUM(ORD_VENTA_CANCELADA_PM)		AS NO_CANCELACIONES_PM,
	SUM(ORD_VENTA_CANCELADA_PY)		AS NO_CANCELACIONES_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_VIDEO,	 				
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_VIDEO,
	NULL AS DUMMY_KF
FROM "RFC_USER"."DASHBOARD_MV_D" 
WHERE FECHA 
		BETWEEN  ADD_DAYS(LAST_DAY(ADD_MONTHS( :DATE_A ,-1)),1)
		 AND  :DATE_A 
AND  CIUDAD != 'SALTILLO'
GROUP BY HUB, COALESCE(SUBREGION,'ND'), REGION, CIUDAD, EMPRESA	
;
 
 else 
 	 var_out = 
SELECT HUB, COALESCE(SUBREGION,'ND') AS SUBREGION , REGION AS REGION_1, 
	CIUDAD AS PLAZA, EMPRESA,
	MAX(:DATE_A) 	AS FECHA_REPORTE,
	SUM(VENTA_TOTAL) 	AS VENTAS_TOTALES,
	SUM(INSTALACIONES) 	AS INSTALACIONES,
	SUM(PERDIDAS) 		AS NO_PERDIDAS,
	SUM(CASE WHEN FECHA = :DATE_A 	THEN NO_RGU ELSE 0 END)	AS NO_RGU,
	SUM(SERVICIOS_VENTAS) 	AS SERVICIOS_VENTAS,
	SUM(SERVICIOS_INSTALACIONS) 	AS SERVICIOS_INSTALACIONS,
	SUM(CASE WHEN FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_NO_RGU,
	SUM(VENTA_TOTAL_PM)	AS VENTAS_TOTALES_PM,
	SUM(INSTALACIONES_PM) 	AS INSTALACIONES_PM,
	SUM(PERDIDAS_PM)	AS NO_PERDIDAS_PM,
	SUM(CASE WHEN FECHA = CASE WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END 
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_PM,
	SUM(VENTA_TOTAL_PY)	AS VENTAS_TOTALES_PY,
	SUM(INSTALACIONES_PY)	AS INSTALACIONES_PY,
	SUM(PERDIDAS_PY)	AS NO_PERDIDAS_PY,
	SUM(CASE WHEN FECHA = :DATE_A THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_PY,
	NULL 				AS VENTAS_IZZY,
	NULL				AS INSTALACIONES_IZZY,
	NULL 				AS PERDIDAS_IZZY,
	NULL 				AS RGU_IZZY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL ELSE 0 END) 	
		AS VENTAS_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL ELSE 0 END) 	
		AS VENTAS_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL ELSE 0 END)	
		AS VENTAS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL_PM ELSE 0 END) 
		AS VENTAS_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL_PM ELSE 0 END)	
		AS VENTAS_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL_PM ELSE 0 END)	
		AS VENTAS_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN VENTA_TOTAL_PY ELSE 0 END) 
		AS VENTAS_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN VENTA_TOTAL_PY ELSE 0 END)	
		AS VENTAS_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN VENTA_TOTAL_PY ELSE 0 END)	
		AS VENTAS_VIDEO_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES ELSE 0 END) 	
		AS INSTALACIONES_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES ELSE 0 END)	
		AS INSTALACIONES_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES_PM ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES_PM ELSE 0 END) 	
		AS INSTALACIONES_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES_PM ELSE 0 END)	
		AS INSTALACIONES_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN INSTALACIONES_PY ELSE 0 END) 	
		AS INSTALACIONES_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN INSTALACIONES_PY ELSE 0 END) 	
		AS INSTALACIONES_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN INSTALACIONES_PY ELSE 0 END)	
		AS INSTALACIONES_VIDEO_PY,	
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS_PM ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS_PM ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET_PM, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS_PM ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN PERDIDAS_PY ELSE 0 END) 	
		AS NO_PERDIDAS_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN PERDIDAS_PY ELSE 0 END) 	
		AS NO_PERDIDAS_INTERNET_PY, 
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		THEN PERDIDAS_PY ELSE 0 END)	
		AS NO_PERDIDAS_VIDEO_PY,	
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	AND  FECHA = :DATE_A 
		THEN NO_RGU ELSE 0 END)	AS NO_RGU_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	AND  FECHA = :DATE_A
	 	THEN NO_RGU ELSE 0 END)	AS NO_RGU_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	AND  FECHA = :DATE_A
	 	THEN NO_RGU ELSE 0 END)	AS NO_RGU_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_TELEFONIA_PM,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1))
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_INTERNET_PM,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = CASE 
		WHEN LAST_DAY(:DATE_A) = :DATE_A 	
		THEN LAST_DAY (ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1)) 
		ELSE ADD_MONTHS(ADD_MONTHS(:DATE_A,-1),1) END
		THEN NO_RGU_PM ELSE 0 END) AS NO_RGU_VIDEO_PM,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = :DATE_A 
		THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_TELEFONIA_PY,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = :DATE_A
	 	THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_INTERNET_PY,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = :DATE_A
	 	THEN NO_RGU_PY ELSE 0 END)	AS NO_RGU_VIDEO_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = :DATE_A
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_TELEFONIA,	
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = :DATE_A
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = :DATE_A
		THEN SERVICIOS_VENTAS ELSE 0 END) 	AS SERVICIOS_VENTAS_VIDEO,			
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	AND  FECHA = :DATE_A
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_TELEFONIA,	
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	AND  FECHA = :DATE_A
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'		AND  FECHA = :DATE_A	
		THEN SERVICIOS_INSTALACIONS ELSE 0 END) 	
		AS SERVICIOS_INSTALACIONS_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	
		AND  FECHA = LEFT(:DATE_A,8) || '01' 	
		THEN SERVICIOS_RGU ELSE 0 END)	AS SERVICIOS_RGU_VIDEO,
	NULL 	AS SERVICIOS_VENTAS_IZZY,
	NULL	AS SERVICIOS_INSTALACIONS_IZZY,
	NULL	AS NO_PERDIDAS_PM_IZZY,
	NULL	AS NO_RGU_PM_IZZY,
	SUM(ORD_VENTA_CANCELADA)		AS NO_CANCELACIONES,
	SUM(ORD_VENTA_CANCELADA_PM)		AS NO_CANCELACIONES_PM,
	SUM(ORD_VENTA_CANCELADA_PY)		AS NO_CANCELACIONES_PY,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	THEN ORD_VENTA_CANCELADA ELSE 0 END)
		AS NO_CANCELACIONES_VIDEO,
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	
		THEN ORD_VENTA_CANCELADA_PM ELSE 0 END)
		AS NO_CANCELACIONES_PM_VIDEO,	 				
	SUM(CASE WHEN CATEGORIA = 'TELEFONIA' 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_TELEFONIA,
	SUM(CASE WHEN CATEGORIA = 'INTERNET' 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_INTERNET,
	SUM(CASE WHEN CATEGORIA = 'VIDEO'	 	
		THEN ORD_VENTA_CANCELADA_PY ELSE 0 END)
		AS NO_CANCELACIONES_PY_VIDEO,
	NULL AS DUMMY_KF
FROM 
"_SYS_BIC"."T.Dashboard/CA_MIS"
	(PLACEHOLDER."$$IN_FROM$$" => ADD_DAYS(LAST_DAY(ADD_MONTHS(:DATE_A,-1)),1),
	 PLACEHOLDER."$$IN_TO$$" => :DATE_A )	
WHERE CIUDAD != 'SALTILLO'
GROUP BY HUB, COALESCE(SUBREGION,'ND'), REGION, CIUDAD, EMPRESA	
;
END IF;
END /********* End Procedure Script ************/