 
 /********* Begin Procedure Script ************/ 
BEGIN 

DECLARE V_INPUT VARCHAR(6);
DECLARE V_INPUT_PM VARCHAR(6);
--SELECT YEAR(:C_INPUT_TO)||MONTH(:C_INPUT_TO) INTO V_INPUT FROM DUMMY;
SELECT "CALMONTH" INTO V_INPUT
FROM "_SYS_BIC"."T_perf/ATT_TIME_HANA"
WHERE "DATE_SQL" = :C_INPUT_TO;

SELECT "CALMONTH" INTO V_INPUT_PM
FROM "_SYS_BIC"."T_perf/ATT_TIME_HANA"
WHERE "DATE_SQL" = ADD_MONTHS(:C_INPUT_TO,-1);

var_out =
SELECT 
O.HUB, COALESCE(O.SUBREGION,'ND') AS SUBREGION, 
O.REGION_1 AS REGION_1,
O.CIUDAD AS PLAZA,
O.EMPRESA,
sum(O.VENTA_TOTAL) as VENTAS_TOTALES, 
sum(O.VENTA_TOTAL_PM) as VENTAS_TOTALES_PM, 
sum(O.VENTA_TOTAL_PY) as VENTAS_TOTALES_PY, 
sum(O.SERVICIOS_VENTAS) as SERVICIOS_VENTAS, 
sum(O.SERVICIOS_INSTALACIONS) as SERVICIOS_INSTALACIONS,
sum(O.INSTALACIONES) as INSTALACIONES, 
sum(O.INSTALACIONES_PM) as INSTALACIONES_PM, 
sum(O.INSTALACIONES_PY) as INSTALACIONES_PY, 
sum(O.NO_PERDIDAS) as NO_PERDIDAS, 
sum(O.NO_PERDIDAS_PM) as NO_PERDIDAS_PM, 
sum(O.NO_PERDIDAS_PY) as NO_PERDIDAS_PY, 
--sum(NO_CANCELACIONES) as NO_CANCELACIONES, 
--sum(NO_CANCELACIONES_PM) as NO_CANCELACIONES_PM, 
--sum(NO_CANCELACIONES_PY) as NO_CANCELACIONES_PY, 
--ORD_VENTA_CANCELADA, ORD_VENTA_CANCELADA_PM, ORD_VENTA_CANCELADA_PY, 
sum(CASE WHEN O.fecha = :C_INPUT_TO /*and R.hub is not null*/ THEN O.NO_RGU ELSE 0 END) as NO_RGU, 
sum(CASE WHEN O.fecha = left(:C_INPUT_TO,8) || '01' /*and R.hub is not null*/ THEN O.SERVICIOS_RGUS ELSE 0 END) as SERVICIOS_NO_RGU,            
sum(CASE WHEN O.fecha = CASE WHEN LAST_DAY(:C_INPUT_TO) = :C_INPUT_TO THEN  LAST_DAY(ADD_MONTHS(:C_INPUT_TO,-1)) 
  ELSE  ADD_MONTHS(:C_INPUT_TO,-1) END /*and R.hub is not null*/ THEN O.NO_RGU_PM ELSE 0 END) as NO_RGU_PM, /*PM*/
sum(CASE WHEN O.fecha = :C_INPUT_TO /*and R.hub is not null*/ THEN O.NO_RGU_PY ELSE 0 END) as NO_RGU_PY,
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.VENTA_TOTAL ELSE 0 END) AS VENTAS_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.INSTALACIONES ELSE 0 END) AS INSTALACIONES_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.NO_PERDIDAS ELSE 0 END) AS PERDIDAS_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') and O.fecha = :C_INPUT_TO and O.hub is not null THEN O.NO_RGU ELSE 0 END) AS RGU_IZZY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.VENTA_TOTAL ELSE 0 END) AS VENTAS_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.VENTA_TOTAL ELSE 0 END) AS VENTAS_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.VENTA_TOTAL ELSE 0 END) AS VENTAS_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.VENTA_TOTAL_PM ELSE 0 END) AS VENTAS_TELEFONIA_PM,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.VENTA_TOTAL_PM ELSE 0 END) AS VENTAS_INTERNET_PM,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.VENTA_TOTAL_PM ELSE 0 END) AS VENTAS_VIDEO_PM,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.VENTA_TOTAL_PY ELSE 0 END) AS VENTAS_TELEFONIA_PY,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.VENTA_TOTAL_PY ELSE 0 END) AS VENTAS_INTERNET_PY,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.VENTA_TOTAL_PY ELSE 0 END) AS VENTAS_VIDEO_PY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.INSTALACIONES ELSE 0 END) AS INSTALACIONES_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.INSTALACIONES ELSE 0 END) AS INSTALACIONES_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.INSTALACIONES ELSE 0 END) AS INSTALACIONES_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.INSTALACIONES_PM ELSE 0 END) AS INSTALACIONES_TELEFONIA_PM,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.INSTALACIONES_PM ELSE 0 END) AS INSTALACIONES_INTERNET_PM,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.INSTALACIONES_PM ELSE 0 END) AS INSTALACIONES_VIDEO_PM,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.INSTALACIONES_PY ELSE 0 END) AS INSTALACIONES_TELEFONIA_PY,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.INSTALACIONES_PY ELSE 0 END) AS INSTALACIONES_INTERNET_PY,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.INSTALACIONES_PY ELSE 0 END) AS INSTALACIONES_VIDEO_PY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.NO_PERDIDAS ELSE 0 END) AS NO_PERDIDAS_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.NO_PERDIDAS ELSE 0 END) AS NO_PERDIDAS_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.NO_PERDIDAS ELSE 0 END) AS NO_PERDIDAS_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.NO_PERDIDAS_PM ELSE 0 END) AS NO_PERDIDAS_TELEFONIA_PM,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.NO_PERDIDAS_PM ELSE 0 END) AS NO_PERDIDAS_INTERNET_PM,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.NO_PERDIDAS_PM ELSE 0 END) AS NO_PERDIDAS_VIDEO_PM,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.NO_PERDIDAS_PY ELSE 0 END) AS NO_PERDIDAS_TELEFONIA_PY,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.NO_PERDIDAS_PY ELSE 0 END) AS NO_PERDIDAS_INTERNET_PY,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.NO_PERDIDAS_PY ELSE 0 END) AS NO_PERDIDAS_VIDEO_PY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') and O.fecha = :C_INPUT_TO THEN O.NO_RGU ELSE 0 END) AS NO_RGU_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') and O.fecha = :C_INPUT_TO THEN O.NO_RGU ELSE 0 END) AS NO_RGU_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') and O.fecha = :C_INPUT_TO THEN O.NO_RGU ELSE 0 END) AS NO_RGU_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') and O.fecha = CASE WHEN LAST_DAY(:C_INPUT_TO) = :C_INPUT_TO THEN  LAST_DAY(ADD_MONTHS(:C_INPUT_TO,-1)) 
  ELSE  ADD_MONTHS(:C_INPUT_TO,-1) END THEN O.NO_RGU_PM ELSE 0 END) AS NO_RGU_TELEFONIA_PM,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') and O.fecha = CASE WHEN LAST_DAY(:C_INPUT_TO) = :C_INPUT_TO THEN  LAST_DAY(ADD_MONTHS(:C_INPUT_TO,-1)) 
  ELSE  ADD_MONTHS(:C_INPUT_TO,-1) END THEN O.NO_RGU_PM ELSE 0 END) AS NO_RGU_INTERNET_PM,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') and O.fecha = CASE WHEN LAST_DAY(:C_INPUT_TO) = :C_INPUT_TO THEN  LAST_DAY(ADD_MONTHS(:C_INPUT_TO,-1)) 
  ELSE  ADD_MONTHS(:C_INPUT_TO,-1) END THEN O.NO_RGU_PM ELSE 0 END) AS NO_RGU_VIDEO_PM,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') and O.fecha = :C_INPUT_TO THEN O.NO_RGU_PY ELSE 0 END) AS NO_RGU_TELEFONIA_PY,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') and O.fecha = :C_INPUT_TO THEN O.NO_RGU_PY ELSE 0 END) AS NO_RGU_INTERNET_PY,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') and O.fecha = :C_INPUT_TO THEN O.NO_RGU_PY ELSE 0 END) AS NO_RGU_VIDEO_PY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.SERVICIOS_VENTAS ELSE 0 END) AS SERVICIOS_VENTAS_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.SERVICIOS_VENTAS ELSE 0 END) AS SERVICIOS_VENTAS_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.SERVICIOS_VENTAS ELSE 0 END) AS SERVICIOS_VENTAS_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.SERVICIOS_INSTALACIONS ELSE 0 END) AS SERVICIOS_INSTALACIONS_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.SERVICIOS_INSTALACIONS ELSE 0 END) AS SERVICIOS_INSTALACIONS_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.SERVICIOS_INSTALACIONS ELSE 0 END) AS SERVICIOS_INSTALACIONS_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') /*and R.hub is not null*/ and O.fecha = left(:C_INPUT_TO,8) || '01' THEN O.SERVICIOS_RGUS 
    ELSE 0 END) AS SERVICIOS_RGU_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') /*and R.hub is not null*/  and O.fecha = left(:C_INPUT_TO,8) || '01' THEN O.SERVICIOS_RGUS
    ELSE 0 END) AS SERVICIOS_RGU_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') /*and R.hub is not null*/ and O.fecha = left(:C_INPUT_TO,8) || '01' THEN O.SERVICIOS_RGUS
    ELSE 0 END) AS SERVICIOS_RGU_VIDEO,           
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.SERVICIOS_VENTAS ELSE 0 END) AS SERVICIOS_VENTAS_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.SERVICIOS_INSTALACIONS ELSE 0 END) AS SERVICIOS_INSTALACIONS_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.NO_PERDIDAS_PM ELSE 0 END) AS NO_PERDIDAS_PM_IZZY, 
sum(CASE WHEN O.EMPRESA IN ('CABLEVISION','CABLEMAS') THEN O.NO_RGU_PM ELSE 0 END) AS NO_RGU_PM_IZZY,
max(:C_INPUT_TO) AS FECHA_REPORTE, sum(O.ORD_VENTA_CANCELADA) as NO_CANCELACIONES, 
sum(O.ORD_VENTA_CANCELADA_PM) as NO_CANCELACIONES_PM,
sum(O.ORD_VENTA_CANCELADA_PY) as NO_CANCELACIONES_PY,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.ORD_VENTA_CANCELADA ELSE 0 END) AS NO_CANCELACIONES_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.ORD_VENTA_CANCELADA ELSE 0 END) AS NO_CANCELACIONES_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.ORD_VENTA_CANCELADA ELSE 0 END) AS NO_CANCELACIONES_VIDEO, 
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.ORD_VENTA_CANCELADA_PM ELSE 0 END) AS NO_CANCELACIONES_PM_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.ORD_VENTA_CANCELADA_PM ELSE 0 END) AS NO_CANCELACIONES_PM_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.ORD_VENTA_CANCELADA_PM ELSE 0 END) AS NO_CANCELACIONES_PM_VIDEO,
sum(CASE WHEN O.CATEGORIA IN ('TELEFONIA','TELEFONIA FIJA') THEN O.ORD_VENTA_CANCELADA_PY ELSE 0 END) AS NO_CANCELACIONES_PY_TELEFONIA,
sum(CASE WHEN O.CATEGORIA IN ('INTERNET') THEN O.ORD_VENTA_CANCELADA_PY ELSE 0 END) AS NO_CANCELACIONES_PY_INTERNET,
sum(CASE WHEN O.CATEGORIA IN ('VIDEO') THEN O.ORD_VENTA_CANCELADA_PY ELSE 0 END) AS NO_CANCELACIONES_PY_VIDEO , 0 AS DUMMY_KF 
------        
FROM ( 
SELECT HUB , SUBREGION , EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END AS REGION_1
,CIUDAD, ORIG_ID, CATEGORIA, FECHA,
SUM(VENTA_TOTAL) AS VENTA_TOTAL, 
SUM(VENTA_TOTAL_PM) AS VENTA_TOTAL_PM, 
SUM(VENTA_TOTAL_PY) AS VENTA_TOTAL_PY, 
SUM(SERVICIOS_VENTAS) AS SERVICIOS_VENTAS,
SUM(INSTALACIONES) AS INSTALACIONES, 
SUM(INSTALACIONES_PM) AS INSTALACIONES_PM, 
SUM(INSTALACIONES_PY) AS INSTALACIONES_PY, 
SUM(SERVICIOS_INSTALACIONS) AS SERVICIOS_INSTALACIONS,
SUM(NO_PERDIDAS) AS NO_PERDIDAS, 
SUM(NO_PERDIDAS_PM) AS NO_PERDIDAS_PM, 
SUM(NO_PERDIDAS_PY) AS NO_PERDIDAS_PY, 
SUM(ORD_VENTA_CANCELADA) AS ORD_VENTA_CANCELADA, 
SUM(ORD_VENTA_CANCELADA_PM) AS ORD_VENTA_CANCELADA_PM, 
SUM(ORD_VENTA_CANCELADA_PY) AS ORD_VENTA_CANCELADA_PY,
NULL AS NO_RGU,
NULL AS NO_RGU_PM,
NULL AS NO_RGU_PY,
NULL AS SERVICIOS_RGUS
FROM "_SYS_BIC"."T/CA_MIS_ROAMBI"
   (PLACEHOLDER."$$INPUT_FROM$$" => :V_INPUT , 
   PLACEHOLDER."$$INPUT_TO$$" => :V_INPUT )
  WHERE
    ("CATEGORIA"  IN  ( 'INTERNET','TELEFONIA','TELEFONIA FIJA','VIDEO'  )  )
  AND FECHA >= ADD_DAYS(LAST_DAY(ADD_MONTHS(:C_INPUT_TO, -1)),1)
  AND FECHA <= :C_INPUT_TO
    AND categoria is not null --or empresa is not null
  and empresa is not null
GROUP BY HUB , SUBREGION , EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END 
,CIUDAD, ORIG_ID, CATEGORIA, FECHA
 
UNION ALL

SELECT   HUB, SUBREGION, EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END AS REGION_1
, CIUDAD , ORIG_ID, CATEGORIA, FECHA,
NULL AS VENTA_TOTAL, 
NULL AS VENTA_TOTAL_PM, 
NULL AS VENTA_TOTAL_PY, 
NULL AS SERVICIOS_VENTAS,
NULL AS INSTALACIONES, 
NULL AS INSTALACIONES_PM, 
NULL AS INSTALACIONES_PY, 
NULL AS SERVICIOS_INSTALACIONS,
NULL AS NO_PERDIDAS, 
NULL AS NO_PERDIDAS_PM, 
NULL AS NO_PERDIDAS_PY, 
NULL AS ORD_VENTA_CANCELADA, 
NULL AS ORD_VENTA_CANCELADA_PM, 
NULL AS ORD_VENTA_CANCELADA_PY,
SUM(NO_RGU) AS NO_RGU,
NULL AS NO_RGU_PM, 
SUM(NO_RGU_PY) AS NO_RGU_PY, 
SUM(SERVICIOS_RGUS) AS SERVICIOS_RGUS
FROM "_SYS_BIC"."T/CA_MIS_RGU_ROAMBI"
(PLACEHOLDER."$$INPUT_FROM$$" => :V_INPUT , 
   PLACEHOLDER."$$INPUT_TO$$" => :V_INPUT )
WHERE
  ("CATEGORIA"  IN  ( 'INTERNET','TELEFONIA','TELEFONIA FIJA','VIDEO'  )  )
  AND FECHA >= ADD_DAYS(LAST_DAY(ADD_MONTHS(:C_INPUT_TO, -1)),1)
  AND FECHA <= :C_INPUT_TO
  AND categoria is not null --or empresa is not null
and empresa is not null
GROUP BY HUB , SUBREGION , EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END 
,CIUDAD, ORIG_ID, CATEGORIA, FECHA
 
UNION ALL

SELECT   HUB, SUBREGION, EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END AS REGION_1
,CIUDAD, ORIG_ID, CATEGORIA, FECHA, 
NULL AS VENTA_TOTAL, 
NULL AS VENTA_TOTAL_PM, 
NULL AS VENTA_TOTAL_PY, 
NULL AS SERVICIOS_VENTAS,
NULL AS INSTALACIONES, 
NULL AS INSTALACIONES_PM, 
NULL AS INSTALACIONES_PY, 
NULL AS SERVICIOS_INSTALACIONS,
NULL AS NO_PERDIDAS, 
NULL AS NO_PERDIDAS_PM, 
NULL AS NO_PERDIDAS_PY, 
NULL AS ORD_VENTA_CANCELADA, 
NULL AS ORD_VENTA_CANCELADA_PM, 
NULL AS ORD_VENTA_CANCELADA_PY,
NULL AS NO_RGU,
SUM(NO_RGU) AS NO_RGU_PM , 
NULL AS NO_RGU_PY, 
NULL AS SERVICIOS_RGUS
FROM "_SYS_BIC"."T/CA_MIS_RGU_ROAMBI" 
(PLACEHOLDER."$$INPUT_FROM$$" => :V_INPUT_PM , 
   PLACEHOLDER."$$INPUT_TO$$" => :V_INPUT_PM ) 
WHERE
  ("CATEGORIA"  IN  ( 'INTERNET','TELEFONIA','TELEFONIA FIJA','VIDEO'  )  )
  AND FECHA >= ADD_DAYS(LAST_DAY(ADD_MONTHS(ADD_MONTHS(:C_INPUT_TO,-1), -1)),1)
  AND FECHA <= CASE WHEN LAST_DAY(:C_INPUT_TO) = :C_INPUT_TO THEN  LAST_DAY(ADD_MONTHS(:C_INPUT_TO,-1)) 
  ELSE ADD_MONTHS(:C_INPUT_TO,-1) END
  AND categoria is not null --or empresa is not null
and empresa is not null
GROUP BY HUB, 
SUBREGION, EMPRESA, 
CASE WHEN ORIG_ID = 3 AND REGION = 'ND' THEN 'METROPOLITANA'
WHEN ORIG_ID = 3 AND REGION IS NULL THEN 'METROPOLITANA'
WHEN ORIG_ID in (1,2) AND REGION = 'ND' THEN 'INTERIOR'
WHEN ORIG_ID in (1,2) AND REGION IS NULL THEN 'INTERIOR'
WHEN ORIG_ID = 4 AND REGION = 'ND' THEN 'NORESTE'
WHEN ORIG_ID = 4 AND REGION IS NULL THEN 'NORESTE'
ELSE REGION END
,CIUDAD, ORIG_ID, CATEGORIA, FECHA
) AS O
group by O.HUB, O.EMPRESA, O.SUBREGION, O.REGION_1,
 O.CIUDAD--, O.ORIG_ID
;
END /********* End Procedure Script ************/