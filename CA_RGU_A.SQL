 
 /********* Begin Procedure Script ************/ 
 BEGIN 

var_out = 
	SELECT COALESCE(EMPRESA,'ND') AS EMPRESA,
	'UNITY' AS TIPO, COALESCE("CATEGORIA",'ND') AS CATEGORIA, COALESCE("CIUDAD",'ND') AS CIUDAD, 
	"REGION1" AS REGION, COALESCE("HUB",'ND') AS HUB, COALESCE("SUBREGION",'ND') AS SUBREGION, 
	"CALMONTH", "MONTH", "YEAR",
	SUM(COALESCE("NO_RGU_INI_MES",0)) AS NO_RGU_INI_MES,
	SUM(COALESCE("NO_RGU_FIN_MES",0)) AS NO_RGU_FIN_MES,
	0 AS SERVICIOS_RGU,
	CASE WHEN SUM(NO_RGU_INI_MES) != 0 
		THEN SUM(COALESCE("NO_RGU_FIN_MES",0)) - SUM(COALESCE("NO_RGU_INI_MES",0)) 
		ELSE 0 END AS GANANCIA_REAL,
	0 AS PPTO_MES_ANT,
	0 AS GANANCIA_PRESUPUESTADA
 	 FROM 	"_SYS_BIC"."T.ROAMBI_A/ANA_RGU_A"
 	 WHERE CALMONTH BETWEEN :C_INPUT_FROM AND :C_INPUT_TO
 	 GROUP BY COALESCE(EMPRESA,'ND') , "REGION1", COALESCE("SUBREGION",'ND'), COALESCE("HUB",'ND'), COALESCE("CIUDAD",'ND'), 
 			"YEAR", "MONTH", "CALMONTH", COALESCE("CATEGORIA",'ND') 
	UNION ALL
	SELECT EMPRESA, TIPO, CATEGORIA, CIUDAD, REGION, HUB, SUBREGION, CALMONTH, MONTH, YEAR,
	SUM(NO_RGU_INI_MES) AS NO_RGU_INI_MES ,
	SUM(NO_RGU_FIN_MES) AS NO_RGU_FIN_MES,
	SUM(SERVICIOS_RGU) AS SERVICIOS_RGU,
	SUM(GANANCIA_REAL) AS GANANCIA_REAL,
	SUM(PPTO_MES_ANT) AS PPTO_MES_ANT, 
	CASE WHEN SUM(PPTO_MES_ANT) !=0 THEN  SUM(SERVICIOS_RGU) - SUM(PPTO_MES_ANT) ELSE 0 END AS GANANCIA_PRESUPUESTADA
	FROM (
	SELECT EMPRESA, 'UNITY' AS TIPO, TIPO_SERVICIO AS CATEGORIA, CIUDAD, REGION1 AS REGION, HUB, SUBREGION,
	CALMONTH, MONTH, YEAR,
	0 AS NO_RGU_INI_MES,
	0 AS NO_RGU_FIN_MES,
	SUM(COALESCE(SERVICIOS_RGU,0)) AS SERVICIOS_RGU,
	0 AS GANANCIA_REAL,
	0 AS PPTO_MES_ANT,
	0 AS GANANCIA_PRESUPUESTADA
	FROM "_SYS_BIC"."T.ROAMBI_A/CA_BUDGET_A" 
	WHERE CALMONTH BETWEEN :C_INPUT_FROM AND :C_INPUT_TO
	GROUP BY EMPRESA, "REGION1", "SUBREGION", "HUB", "CIUDAD", 
 			"YEAR", "MONTH", "CALMONTH", "TIPO_SERVICIO"
 	UNION ALL
 	SELECT EMPRESA, 'UNITY' AS TIPO, TIPO_SERVICIO AS CATEGORIA, CIUDAD, REGION1 AS REGION, HUB, SUBREGION,
	B.CALMONTH, B.MONTH, B.YEAR,
	0 AS NO_RGU_INI_MES,
	0 AS NO_RGU_FIN_MES,
	0 AS SERVICIOS_RGU,
	0 AS GANANCIA_REAL,
	SUM(COALESCE(SERVICIOS_RGU,0)) AS PPTO_MES_ANT,
	0 AS GANANCIA_PRESUPUESTADA
	FROM "_SYS_BIC"."T.ROAMBI_A/CA_BUDGET_A" AS A
	INNER JOIN "_SYS_BIC"."T/ATT_TIME_HANA" AS B
	ON ADD_MONTHS(A.DATE_SQL,1) = B.DATE_SQL
	WHERE B.CALMONTH BETWEEN :C_INPUT_FROM AND :C_INPUT_TO
	GROUP BY EMPRESA, "REGION1", "SUBREGION", "HUB", "CIUDAD", 
 			B."YEAR", B."MONTH", B."CALMONTH", "TIPO_SERVICIO")
 	GROUP BY EMPRESA, TIPO, CATEGORIA, CIUDAD, REGION, HUB, SUBREGION, CALMONTH, MONTH, YEAR
 	;
END 
/********* End Procedure Script ************/